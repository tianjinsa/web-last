<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡ç‰‡ç»„æµ‹è¯•</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #0a0e1a;
            color: #e6e9f0;
            padding: 20px;
        }
        
        h1 {
            margin-bottom: 20px;
            color: #7b6cff;
        }
        
        .info {
            background: rgba(123, 108, 255, 0.1);
            border: 1px solid rgba(123, 108, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .cardgroup {
            --hover-act: ;
            --unhover-act: ;
            --card-gap: 10px;
            
            display: flex;
            gap: 0;
            position: relative;
            background: rgba(255, 255, 255, 0.02);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            padding: 20px;
            min-height: 400px;
        }
        
        .card-t {
            display: flex;
            flex-direction: row;
            background: rgba(25, 32, 51, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
            
            --base-x: 0px;
            --offset-x: 0px;
            width: fit-content !important;
            height: 100% !important;
            will-change: transform;
            transform: translate3d(calc(var(--base-x) + var(--offset-x)), 0, 0) var(--unhover-act) !important;
            transition: transform 0.3s ease !important;
        }
        
        .cardhead {
            width: 60px;
            background: rgba(18, 24, 40, 0.9);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: 600;
            font-size: 0.9375rem;
            letter-spacing: 0.1em;
            color: #6e7a94;
            flex-shrink: 0;
        }
        
        .cardbody {
            flex-shrink: 0;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }
        
        .test-content {
            padding: 10px;
            background: rgba(123, 108, 255, 0.1);
            border-radius: 8px;
            margin: 5px 0;
        }
        
        #log {
            margin-top: 20px;
            padding: 15px;
            background: #000;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            color: #4ade80;
        }
        
        #log div {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ´ å¡ç‰‡ç»„æ‰‹é£ç´æµ‹è¯•</h1>
    
    <div class="info">
        <strong>æµ‹è¯•è¯´æ˜ï¼š</strong>
        <ul style="margin-left: 20px; margin-top: 10px;">
            <li>æ‚¬åœåœ¨å¡ç‰‡ä¸Šåº”è¯¥çœ‹åˆ°åç»­å¡ç‰‡å‘å³æ¨å¼€</li>
            <li>ç¬¬äºŒå¼ å¡ç‰‡åº”è¯¥è‡ªåŠ¨å¡«æ»¡å‰©ä½™ç©ºé—´</li>
            <li>æŸ¥çœ‹ä¸‹æ–¹æ§åˆ¶å°æ—¥å¿—äº†è§£æ‰§è¡Œè¯¦æƒ…</li>
        </ul>
    </div>
    
    <div class="cardgroup" id="test-group">
        <div class="card-t">
            <div class="cardhead">å¡ç‰‡1</div>
            <div class="cardbody" style="width: 300px;">
                <div class="test-content">å†…å®¹1-1</div>
                <div class="test-content">å†…å®¹1-2</div>
                <div class="test-content">å†…å®¹1-3</div>
            </div>
        </div>
        
        <div class="card-t">
            <div class="cardhead">å¡ç‰‡2</div>
            <div class="cardbody" style="width: 400px;">
                <div class="test-content">å†…å®¹2-1</div>
                <div class="test-content">å†…å®¹2-2</div>
                <div class="test-content">å†…å®¹2-3</div>
                <div class="test-content">å†…å®¹2-4</div>
            </div>
        </div>
    </div>
    
    <div id="log"></div>
    
    <script>
        const logContainer = document.getElementById('log');
        
        function log(message, ...args) {
            const text = `[${new Date().toLocaleTimeString()}] ${message}`;
            console.log(text, ...args);
            const div = document.createElement('div');
            div.textContent = text + (args.length ? ' ' + JSON.stringify(args) : '');
            logContainer.appendChild(div);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // å¤åˆ¶ä½ çš„ cardsInit å‡½æ•°
        function cardsInit() {
            log("Initializing Cards Module");
            
            document.querySelectorAll('.cardgroup').forEach(group => {
                log("Found card group, initializing...");
                
                const cardlist = group.querySelectorAll('.card-t');
                log(`Found ${cardlist.length} cards`);
                
                const widthlist = [];
                let activeNode = null;
                let allwidth = 0;
                let totleheadwidth = 0;
                
                const hoveract = window.getComputedStyle(group).getPropertyValue('--hover-act').trim();
                log(`Hover action value: "${hoveract}"`);

                cardlist.forEach((card, i) => {
                    card.style.zIndex = i + 1;
                    
                    const body = cardlist[i].getElementsByClassName('cardbody')[0];
                    const computedStyle = window.getComputedStyle(card);
                    const borderLeft = parseFloat(computedStyle.borderLeftWidth) || 0;
                    const borderRight = parseFloat(computedStyle.borderRightWidth) || 0;
                    const totalBorderWidth = borderLeft + borderRight;

                    widthlist[i] = body.offsetWidth + totalBorderWidth;
                    log(`Card ${i}: body width = ${body.offsetWidth}, border = ${totalBorderWidth}, total = ${widthlist[i]}`);
                    
                    const head = cardlist[i].getElementsByClassName('cardhead')[0];
                    const headWidth = head.offsetWidth + totalBorderWidth;
                    totleheadwidth += headWidth;
                    log(`Card ${i}: head width = ${headWidth}, total head width = ${totleheadwidth}`);
                    
                    if (i > 0) {
                        allwidth += widthlist[i - 1];
                        card.style.setProperty('--base-x', `-${allwidth}px`);
                        log(`Card ${i}: set --base-x to -${allwidth}px`);
                    }
                    
                    card.addEventListener('mouseenter', () => {
                        log(`Mouse entered card ${i}`);
                        requestAnimationFrame(() => {
                            if (activeNode !== null && activeNode !== i) {
                                for (let j = activeNode + 1; j < cardlist.length; j++) {
                                    cardlist[j].style.setProperty('--offset-x', '');
                                }
                                cardlist[activeNode].style.setProperty('--unhover-act', '');
                            }

                            for (let j = i + 1; j < cardlist.length; j++) {
                                const offset = `calc(${widthlist[i]}px + var(--card-gap))`;
                                cardlist[j].style.setProperty('--offset-x', offset);
                                log(`Card ${j}: set --offset-x to ${offset}`);
                            }

                            card.style.setProperty('--unhover-act', hoveract);
                            activeNode = i;
                        });
                    });

                    card.addEventListener('mouseleave', () => {
                        log(`Mouse left card ${i}`);
                        requestAnimationFrame(() => {
                            card.style.setProperty('--unhover-act', '');
                        });
                    });
                });
                
                const lastCard = cardlist[cardlist.length - 1];
                if (!lastCard) return;
                
                const lastBody = lastCard.getElementsByClassName('cardbody')[0];
                const updateLastCardLayout = () => {
                    if (cardlist.length === 0) return;
                    const groupWidth = group.offsetWidth;
                    log(`Group width: ${groupWidth}, Total head width: ${totleheadwidth}`);
                    
                    if (totleheadwidth < groupWidth - 100) {
                        const newWidth = groupWidth - totleheadwidth;
                        log(`Setting last card body min-width to: ${newWidth}px`);
                        lastBody.style.minWidth = newWidth + 'px';
                    } else {
                        log(`Not enough space, keeping default width`);
                        lastBody.style.minWidth = '';
                    }
                };

                updateLastCardLayout();

                const observer = new ResizeObserver(() => {
                    log('Group resized, updating layout...');
                    updateLastCardLayout();
                });

                observer.observe(group);
            });
            
            log("Cards initialization complete!");
        }
        
        // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿ DOM å®Œå…¨æ¸²æŸ“
        setTimeout(() => {
            cardsInit();
        }, 100);
    </script>
</body>
</html>
